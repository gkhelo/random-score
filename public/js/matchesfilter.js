import{matches as renderMatches}from"./render.js";import{getDay}from"./time.js";export const MatchesFilter={create(e){let t=document.createElement("div");return t.className="matches-filter",t.appendChild(this.statusFilter()),t.appendChild(this.dayFilter(e)),t},statusFilter(){let e=document.createElement("div");e.className="status-filter";let t=document.createElement("ul");return t.appendChild(this.checkboxFilter("Scheduled","NOT_STARTED")),t.appendChild(this.checkboxFilter("Live","INPLAY")),t.appendChild(this.checkboxFilter("Finished","FINISHED")),e.appendChild(t),e},dayFilter(e){let t=document.createElement("div");return t.className="day-filter",t.appendChild(this.calendar(e)),t.appendChild(this.expandedCalendar(e)),t},checkboxFilter(e,t){let a=document.createElement("li");a.innerHTML=`<label for="${t}">${e}</label>`;let d=document.createElement("input");return d.className="matches-checkbox",d.id="filter-"+t,d.type="checkbox",d.value=t,d.checked=!0,d.addEventListener("change",()=>{this.filterMatches(this.getCheckedStatuses())}),a.appendChild(d),a},filterMatches(e){let t=JSON.stringify(e),a=this.getSelectedDay(),d="/api/matches/filter/"+a+"/"+t;Server.isAvailable||(0==e.length&&(e="empry"),d="/local/api/matches/filter/"+a+"/"+e+".json"),fetch(d).then(e=>e.json()).then(e=>{Match.hideAll(),e.forEach(e=>{Match.update(e)})}).catch(e=>{console.log("Error occured during rendering matches:",e)})},getCheckedStatuses(){let e=document.getElementsByClassName("matches-checkbox"),t=[];return Array.prototype.forEach.call(e,e=>{e.checked&&t.push(e.value)}),t},calendar(e){let t=document.createElement("div");return t.className="calendar",t.innerHTML=`\n            <div class="calendar-wrapper">\n                <img src="./images/calendar.png">\n            </div>\n            <div class="selected-day" id="selected-day">Day ${e}</div>\n        `,t.addEventListener("click",()=>{let e=document.getElementById("expanded-calendar");"none"==e.style.display?e.style.display="block":e.style.display="none"}),t},expandedCalendar(e){let t=document.createElement("div");t.className="expanded-calendar",t.id="expanded-calendar",t.style.display="none";let a=document.createElement("ul");for(let t=1;t<=60;t++){let d=document.createElement("li");d.className="day",d.innerHTML="Day "+t,d.addEventListener("click",()=>{this.updateSelectedDay(t),document.getElementById("expanded-calendar").style.display="none",renderMatches(t)}),t==e&&d.classList.add("today"),t==getDay()&&d.classList.add("live"),a.appendChild(d)}return t.appendChild(a),t},getSelectedDay(){let e=document.getElementById("selected-day").innerHTML;return parseInt(e.substring(4))},updateSelectedDay(e){document.getElementById("selected-day").innerHTML="Day "+e}};